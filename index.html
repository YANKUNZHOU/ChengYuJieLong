<!DOCTYPE html>
<html>
<head>
    <title>离线成语接龙</title>
    <meta charset="UTF-8">
    <style>
        body { max-width: 800px; margin: 20px auto; padding: 20px; font-family: 'Microsoft YaHei', sans-serif; }
        .game-area { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        #history { min-height: 120px; border: 1px solid #dee2e6; padding: 10px; margin: 10px 0; background: white; line-height: 1.6; }
        .highlight { color: #28a745; font-weight: 700; font-size: 1.3em; }
        .error { color: #dc3545; animation: shake 0.5s; }
        input { padding: 8px; width: 220px; margin-right: 10px; border: 2px solid #ced4da; border-radius: 4px; }
        button { padding: 8px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.3s; }
        button:hover { background: #0056b3; transform: translateY(-1px); }
        .loading { color: #6c757d; font-style: italic; }
        @keyframes shake {
            0%,100% {transform: translateX(0)}
            25% {transform: translateX(5px)}
            75% {transform: translateX(-5px)}
        }
    </style>
</head>
<body>
    <h2 style="color: #2c3e50; text-align: center;">成语接龙</h2>
    <div class="game-area">
        <div id="current" class="loading">正在初始化游戏...</div>
        <div style="margin: 15px 0;">
            <input type="text" id="input" placeholder="输入四字成语" disabled>
            <button onclick="submitWord()" disabled>提交</button>
            <button onclick="initGame()" disabled>重新开始</button>
        </div>
        <div id="history"></div>
    </div>

<script>
// 内置成语数据库（精简版示例，实际包含2000+条）
const idiomData = [
    {"word":"一帆风顺","pinyin":"yī fān fēng shùn","definition":"比喻非常顺利，没有任何阻碍"},
    {"word":"顺水推舟","pinyin":"shùn shuǐ tuī zhōu","definition":"比喻顺着某个趋势或方便的条件办事"},
    {"word":"舟车劳顿","pinyin":"zhōu chē láo dùn","definition":"形容旅途疲劳困顿"},
    {"word":"顿开茅塞","pinyin":"dùn kāi máo sè","definition":"比喻立刻理解明白"},
    {"word":"塞翁失马","pinyin":"sài wēng shī mǎ","definition":"比喻坏事可能变成好事"},
    // 此处实际应包含2000+个成语...
    {"word":"马到成功","pinyin":"mǎ dào chéng gōng","definition":"比喻迅速取得胜利"},
    {"word":"功成名就","pinyin":"gōng chéng míng jiù","definition":"功业建立了，名声也有了"},
    {"word":"就事论事","pinyin":"jiù shì lùn shì","definition":"按照事物本身的性质来评定是非得失"},
    {"word":"事半功倍","pinyin":"shì bàn gōng bèi","definition":"形容花费的劳力小，收到的成效大"},
    {"word":"倍日并行","pinyin":"bèi rì bìng xíng","definition":"日夜赶路"}
    // 更多成语...
];

let currentWord = null;
let usedWords = new Set();
let idiomMap = new Map();
let charIndex = new Map();

function initGame() {
    // 初始化数据结构
    idiomMap.clear();
    charIndex.clear();
    
    // 构建快速索引
    idiomData.forEach(idiom => {
        const firstChar = idiom.word[0];
        idiomMap.set(idiom.word, idiom);
        if (!charIndex.has(firstChar)) {
            charIndex.set(firstChar, []);
        }
        charIndex.get(firstChar).push(idiom);
    });

    // 启用控件
    document.getElementById('input').disabled = false;
    document.querySelectorAll('button').forEach(btn => btn.disabled = false);
    
    // 随机选择起始成语
    const words = Array.from(idiomMap.keys());
    const randomWord = words[Math.floor(Math.random() * words.length)];
    currentWord = idiomMap.get(randomWord);
    usedWords = new Set([currentWord.word]);
    
    updateDisplay();
    document.getElementById('input').focus();
}

function validateInput(input) {
    if (!input) return { valid: false, message: "请输入成语" };
    if (input.length !== 4) return { valid: false, message: "请输入四字成语" };
    if (!idiomMap.has(input)) return { valid: false, message: "成语不存在" };
    if (usedWords.has(input)) return { valid: false, message: "成语已使用" };
    if (input[0] !== currentWord.word.slice(-1)) {
        return { valid: false, message: `首字需为【${currentWord.word.slice(-1)}】` };
    }
    return { valid: true };
}

function findNextAIWord(lastChar) {
    const candidates = charIndex.get(lastChar) || [];
    const available = candidates.filter(idiom => !usedWords.has(idiom.word));
    
    // 优先选择常用成语（此处简化处理，实际可根据使用频率排序）
    return available.length > 0 ? available[0] : null;
}

function submitWord() {
    const inputElem = document.getElementById('input');
    const userInput = inputElem.value.trim();
    const validation = validateInput(userInput);
    
    if (!validation.valid) {
        showError(validation.message);
        inputElem.classList.add('error');
        setTimeout(() => inputElem.classList.remove('error'), 1000);
        return;
    }

    usedWords.add(userInput);
    currentWord = idiomMap.get(userInput);
    updateDisplay();
    
    setTimeout(() => {
        const lastChar = currentWord.word.slice(-1);
        const nextWord = findNextAIWord(lastChar);
        
        if (nextWord) {
            usedWords.add(nextWord.word);
            currentWord = nextWord;
            updateDisplay();
        } else {
            showError("AI认输，你赢了！");
        }
    }, 500);
}

function updateDisplay() {
    document.getElementById('current').innerHTML = `
        <p>当前成语：<span class="highlight">${currentWord.word}</span></p>
        ${currentWord.pinyin ? `<p>拼音：${currentWord.pinyin}</p>` : ''}
        ${currentWord.definition ? `<p>释义：${currentWord.definition}</p>` : ''}
    `;
    document.getElementById('history').innerHTML = 
        `接龙轨迹：<br>${Array.from(usedWords).join(" → ")}`;
    document.getElementById('input').value = '';
}

function showError(message) {
    const historyElem = document.getElementById('history');
    historyElem.innerHTML = `<span class="error">${message}</span><br>${historyElem.innerHTML}`;
}

// 自动初始化
window.onload = () => {
    setTimeout(initGame, 500); // 模拟加载过程
};
</script>
</body>
</html>